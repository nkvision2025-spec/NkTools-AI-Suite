<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NkTools - Ultimate AI Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        body { font-family: 'Outfit', sans-serif; background: #010409; color: #e6edf3; margin: 0; padding: 0; }
        
        .glass-card { background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(48, 54, 61, 1); border-radius: 1rem; }
        
        /* Sidebar/Nav Styles */
        .nav-item { cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 0.75rem; display: flex; align-items: center; gap: 12px; padding: 12px 16px; color: #8b949e; border: 1px solid transparent; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-item.active { background: rgba(35, 134, 54, 0.15); color: #3fb950; border: 1px solid rgba(63, 185, 80, 0.3); }
        .nav-item.active i { color: #3fb950; }

        .loader { border: 3px solid rgba(255,255,255,0.1); border-top-color: #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .hidden { display: none !important; }
        .drop-zone { border: 2px dashed #30363d; min-height: 160px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 0.75rem; cursor: pointer; transition: 0.2s; }
        .drop-zone:hover { border-color: #3b82f6; background: rgba(59,130,246,0.05); }
        img.preview { max-width: 100%; max-height: 200px; border-radius: 0.5rem; margin-top: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Top Navbar -->
    <header class="border-b border-gray-800 bg-[#0d1117] sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                    <i class="fas fa-microchip"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg leading-tight">NkTools <span class="text-blue-500 text-xs px-1.5 py-0.5 border border-blue-500 rounded ml-1">PRO</span></h1>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest font-semibold">Baki ke tools yahan hain â†“</p>
                </div>
            </div>
            <button onclick="toggleSetup()" class="p-2 text-gray-400 hover:text-white transition-colors"><i class="fas fa-key"></i></button>
        </div>
    </header>

    <div class="max-w-7xl mx-auto flex flex-col md:flex-row min-h-[calc(100vh-64px)]">
        
        <!-- Sidebar Navigation (ALWAYS VISIBLE) -->
        <aside class="w-full md:w-64 p-4 border-r border-gray-800 bg-[#0d1117]">
            <div class="flex flex-col gap-2">
                <div onclick="switchTab('vision')" id="btn-vision" class="nav-item active">
                    <i class="fas fa-eye w-5"></i>
                    <span class="font-semibold text-sm">Vision AI</span>
                </div>
                <div onclick="switchTab('art')" id="btn-art" class="nav-item">
                    <i class="fas fa-paint-brush w-5"></i>
                    <span class="font-semibold text-sm">Art Generator</span>
                </div>
                <div onclick="switchTab('edit')" id="btn-edit" class="nav-item">
                    <i class="fas fa-wand-magic-sparkles w-5"></i>
                    <span class="font-semibold text-sm">Image Editor</span>
                </div>
                <div onclick="switchTab('video')" id="btn-video" class="nav-item">
                    <i class="fas fa-film w-5"></i>
                    <span class="font-semibold text-sm">Video Planner</span>
                </div>
                
                <hr class="my-4 border-gray-800">
                
                <div class="p-3 bg-gray-900/50 rounded-lg">
                    <p class="text-[10px] font-bold text-gray-500 mb-2 uppercase">System Status</p>
                    <div class="flex items-center gap-2 text-xs text-green-500">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        AI Engine Ready
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 p-4 md:p-8 bg-[#010409]">
            
            <!-- Tab 1: Vision AI -->
            <section id="tab-vision" class="tab-pane max-w-2xl mx-auto">
                <div class="glass-card p-6 shadow-xl">
                    <h2 class="text-xl font-bold mb-1">Image to Prompt</h2>
                    <p class="text-sm text-gray-400 mb-6">Photo upload karein aur best AI prompt payein.</p>
                    
                    <div class="drop-zone" onclick="document.getElementById('file-v').click()">
                        <input type="file" id="file-v" class="hidden" accept="image/*" onchange="handlePreview(this, 'prev-v', 'zone-v-txt')">
                        <div id="zone-v-txt" class="text-center">
                            <i class="fas fa-upload text-gray-600 text-2xl mb-2"></i>
                            <p class="text-xs text-gray-500 font-bold uppercase">Click to Upload</p>
                        </div>
                        <img id="prev-v" class="preview hidden">
                    </div>
                    
                    <button onclick="runVision()" class="w-full mt-6 bg-blue-600 hover:bg-blue-500 py-3 rounded-lg font-bold transition-all shadow-lg shadow-blue-900/20">ANALYZE IMAGE</button>
                    
                    <div id="res-v" class="mt-6 p-4 bg-gray-900 rounded-lg border border-gray-800 hidden">
                        <p id="txt-v" class="text-sm text-gray-300 italic"></p>
                    </div>
                </div>
            </section>

            <!-- Tab 2: Art Generator -->
            <section id="tab-art" class="tab-pane hidden max-w-2xl mx-auto">
                <div class="glass-card p-6">
                    <h2 class="text-xl font-bold mb-1">AI Art Generator</h2>
                    <p class="text-sm text-gray-400 mb-6">Text se high-quality images banayein.</p>
                    <textarea id="prompt-art" class="w-full bg-[#0d1117] border border-gray-800 p-4 rounded-lg text-sm mb-4 outline-none focus:border-green-500 min-h-[100px]" placeholder="Explain your imagination..."></textarea>
                    <button onclick="runArt()" class="w-full bg-green-600 hover:bg-green-500 py-3 rounded-lg font-bold">GENERATE ART</button>
                    <div id="res-art" class="mt-8 text-center hidden">
                        <img id="out-art" class="rounded-lg shadow-2xl mx-auto border border-gray-800">
                    </div>
                </div>
            </section>

            <!-- Tab 3: Editor -->
            <section id="tab-edit" class="tab-pane hidden max-w-2xl mx-auto">
                <div class="glass-card p-6">
                    <h2 class="text-xl font-bold mb-1">AI Image Editor</h2>
                    <p class="text-sm text-gray-400 mb-6">Photo mein kuch bhi change karein.</p>
                    <div class="grid gap-4 mb-4">
                        <div class="drop-zone" onclick="document.getElementById('file-e').click()">
                            <input type="file" id="file-e" class="hidden" accept="image/*" onchange="handlePreview(this, 'prev-e', 'zone-e-txt')">
                            <div id="zone-e-txt" class="text-xs text-gray-600 font-bold">SOURCE IMAGE</div>
                            <img id="prev-e" class="preview hidden">
                        </div>
                        <textarea id="prompt-edit" class="w-full bg-[#0d1117] border border-gray-800 p-4 rounded-lg text-sm outline-none focus:border-purple-500" placeholder="Kya change karna hai? (e.g. Add a hat)"></textarea>
                    </div>
                    <button onclick="runEdit()" class="w-full bg-purple-600 hover:bg-purple-500 py-3 rounded-lg font-bold">APPLY CHANGES</button>
                    <div id="res-edit" class="mt-6 hidden"><img id="out-edit" class="rounded-lg mx-auto"></div>
                </div>
            </section>

            <!-- Tab 4: Video Planner -->
            <section id="tab-video" class="tab-pane hidden max-w-2xl mx-auto">
                <div class="glass-card p-6">
                    <h2 class="text-xl font-bold mb-1">Video Planner</h2>
                    <p class="text-sm text-gray-400 mb-6">AI Storyboard aur Script generator.</p>
                    <input type="text" id="prompt-vid" class="w-full bg-[#0d1117] border border-gray-800 p-4 rounded-lg mb-4 text-sm outline-none focus:border-orange-500" placeholder="Video topic ya concept...">
                    <button onclick="runVideo()" class="w-full bg-orange-600 hover:bg-orange-500 py-3 rounded-lg font-bold">CREATE STORYBOARD</button>
                    <div id="res-video" class="mt-6 p-4 bg-gray-900 rounded-lg hidden">
                        <p id="txt-video" class="text-sm text-gray-300 whitespace-pre-wrap"></p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- API Setup Modal -->
    <div id="setup-screen" class="fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-6 hidden">
        <div class="glass-card p-8 w-full max-w-sm text-center">
            <h2 class="text-xl font-bold mb-4">Settings</h2>
            <input type="password" id="api-key-input" class="w-full bg-gray-900 border border-gray-700 p-3 rounded-lg mb-4 text-center text-sm outline-none focus:border-blue-500" placeholder="Enter Gemini API Key">
            <button onclick="saveSetup()" class="w-full bg-blue-600 py-3 rounded-lg font-bold mb-2">Save Key</button>
            <button onclick="toggleSetup()" class="text-gray-500 text-xs uppercase font-bold tracking-widest mt-2">Close</button>
        </div>
    </div>

    <!-- Universal Loader -->
    <div id="loader-overlay" class="fixed inset-0 z-[200] bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center hidden">
        <div class="loader mb-4"></div>
        <p id="load-msg" class="text-[10px] font-bold text-blue-400 uppercase tracking-[0.3em] animate-pulse">Running Model...</p>
    </div>

    <script>
        const KEY = 'nk_pro_suite_key';
        let state = { apiKey: localStorage.getItem(KEY) || "" };

        window.onload = () => {
            if(!state.apiKey) toggleSetup();
            else document.getElementById('api-key-input').value = state.apiKey;
        };

        function toggleSetup() { document.getElementById('setup-screen').classList.toggle('hidden'); }
        
        function saveSetup() {
            const val = document.getElementById('api-key-input').value.trim();
            if(!val) return;
            localStorage.setItem(KEY, val);
            state.apiKey = val;
            toggleSetup();
            location.reload();
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.add('hidden'));
            document.getElementById(`tab-${id}`).classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${id}`).classList.add('active');
        }

        function handlePreview(input, imgId, txtId) {
            const file = input.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = document.getElementById(imgId);
                    img.src = e.target.result;
                    img.classList.remove('hidden');
                    document.getElementById(txtId).classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        async function callGemini(model, payload) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${state.apiKey}`;
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await res.json();
            if(!res.ok) throw new Error(data.error?.message || "Error");
            return data;
        }

        function setLoader(show, msg) {
            document.getElementById('loader-overlay').classList.toggle('hidden', !show);
            if(msg) document.getElementById('load-msg').innerText = msg;
        }

        // --- Tools Logic (Using Stable Gemini 2.5 Flash) ---

        async function runVision() {
            const file = document.getElementById('file-v').files[0];
            if(!file) return alert("Photo select karein!");
            setLoader(true, "Analyzing with Gemini 2.5...");
            try {
                const b64 = await toBase64(file);
                const data = await callGemini('gemini-2.5-flash-preview-09-2025', {
                    contents: [{ parts: [
                        { text: "Detailed prompt for AI image generation based on this style." },
                        { inlineData: { mimeType: file.type, data: b64 } }
                    ]}]
                });
                document.getElementById('txt-v').innerText = data.candidates[0].content.parts[0].text;
                document.getElementById('res-v').classList.remove('hidden');
            } catch(e) { alert(e.message); }
            setLoader(false);
        }

        async function runArt() {
            const p = document.getElementById('prompt-art').value;
            if(!p) return alert("Prompt likhein!");
            setLoader(true, "Imagen 4.0 Generating...");
            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${state.apiKey}`;
                const res = await fetch(url, {
                    method: 'POST',
                    body: JSON.stringify({ instances: { prompt: p }, parameters: { sampleCount: 1 } })
                });
                const data = await res.json();
                const b64 = data.predictions?.[0]?.bytesBase64Encoded;
                if(!b64) throw new Error("Empty Response - Quota Exceeded?");
                document.getElementById('out-art').src = `data:image/png;base64,${b64}`;
                document.getElementById('res-art').classList.remove('hidden');
            } catch(e) { 
                // Fallback attempt
                try {
                    setLoader(true, "Retrying with Flash Image...");
                    const fRes = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${state.apiKey}`, {
                        method: 'POST',
                        body: JSON.stringify({ contents: [{parts:[{text:p}]}], generationConfig: { responseModalities:['IMAGE'] } })
                    });
                    const fData = await fRes.json();
                    const fb64 = fData.candidates[0].content.parts.find(p => p.inlineData).inlineData.data;
                    document.getElementById('out-art').src = `data:image/png;base64,${fb64}`;
                    document.getElementById('res-art').classList.remove('hidden');
                } catch(e2) { alert("Sare tools ki limit khatam hai: " + e2.message); }
            }
            setLoader(false);
        }

        async function runEdit() {
            const file = document.getElementById('file-e').files[0];
            const p = document.getElementById('prompt-edit').value;
            if(!file || !p) return alert("Select image & enter change!");
            setLoader(true, "Editing Image...");
            try {
                const b64 = await toBase64(file);
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${state.apiKey}`, {
                    method: 'POST',
                    body: JSON.stringify({
                        contents: [{ parts: [
                            { text: "Change image as per: " + p },
                            { inlineData: { mimeType: file.type, data: b64 } }
                        ]}],
                        generationConfig: { responseModalities: ['IMAGE'] }
                    })
                });
                const data = await res.json();
                const outB64 = data.candidates[0].content.parts.find(p => p.inlineData).inlineData.data;
                document.getElementById('out-edit').src = `data:image/png;base64,${outB64}`;
                document.getElementById('res-edit').classList.remove('hidden');
            } catch(e) { alert(e.message); }
            setLoader(false);
        }

        async function runVideo() {
            const p = document.getElementById('prompt-vid').value;
            if(!p) return alert("Enter concept!");
            setLoader(true, "Planning Script...");
            try {
                const data = await callGemini('gemini-2.5-flash-preview-09-2025', {
                    contents: [{ parts: [{ text: `Create a professional 5-scene video storyboard with visual descriptions and audio script for: ${p}` }] }],
                    tools: [{ "google_search": {} }]
                });
                document.getElementById('txt-video').innerText = data.candidates[0].content.parts[0].text;
                document.getElementById('res-video').classList.remove('hidden');
            } catch(e) { alert(e.message); }
            setLoader(false);
        }

        function toBase64(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>